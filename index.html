<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SA-ES generators</title>
  </head>
  <body>
    <div style="border: 1px solid #000; padding: 45px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);">
      <span style="font-family: times new roman;">
        <div align="center">
          <span style="font-size: 200%; line-height: normal">SAN FIERRO POLICE DEPARTMENT</span><br>
          <div style="padding: 0px 0px 10px 0px"><span style="font-size: 150%; line-height: normal">«Gold in peace, Iron in war»</span></div>
        </div>
      </span>
      <div class="aligned">
        <div style="display: flex; align-items: center;">
          <div style="padding: 0px 10px 0px 0px"><img class="postimage" alt="Изображение" src="https://i.imgur.com/Qgb0BTE.png" style="max-width: 100px;"></div>
          <br>
          <div align="center">1351, Rich Street,<br>Financial, San Fierro, SA<br>ZIP-CODE: 356212</div>
        </div>
        <div style="display: flex; align-items: center;">
          <div align="center">Ray Walsh<br>CHIEF OF POLICE<br>SAN FIERRO POLICE</div>
          <div style="padding: 0px 0px 0px 10px"><img class="postimage" alt="Изображение" src="https://i.imgur.com/lzeu2V5.png" style="max-width: 100px;"></div>
        </div>
      </div>
      <style>
        .aligned {
        display: flex;
        justify-content: space-between;
        align-items: center;
        @media (max-width: 750px) {
        flex-direction: column;
        }
        }
      </style>
      <div align="center"><span style="font-family: Times New Roman;"><span style="font-size: 160%; line-height: 116%;"><span style="font-weight: bold">Back Home Program</span></span></span></div>
      <hr>
      <span style="font-weight: bold"><span style="font-size: 120%; line-height: 116%;">Application</span></span><br><br><span style="font-size: 90%; line-height: 116%;"><span style="font-weight: bold">Фракции, в которых вы состояли (включая никнеймы, проекты, лидеры и причины ухода):</span>  %input.ans1%</span><br><span style="font-size: 90%; line-height: 116%;"><span style="font-weight: bold">Планы на будущего персонажа:</span> %input.ans2%</span><br><br><span style="font-size: 90%; line-height: 116%;"><span style="font-weight: bold">Ccылка на форумный аккаунт (G-RP):</span> %input.ans3%</span><br><span style="font-size: 90%; line-height: 116%;"><span style="font-weight: bold">ПОЛНЫЙ Скриншот защиты (Телеграм, Google):</span> %input.ans4%</span><br><span style="font-size: 90%; line-height: 116%;"><span style="font-weight: bold">Полный скриншот окна ЮЦП:</span> %input.ans5%</span><br><span style="font-size: 90%; line-height: 116%;"><span style="font-weight: bold">Ссылка на страницу ВКонтакте:</span> %input.ans6%</span><br><br><span style="font-size: 90%; line-height: 116%;"><span style="font-weight: bold">Скриншоты вашей игры (СС, необязательно за копов):</span> %input.ans7%</span><br><span style="font-size: 90%; line-height: 116%;"><span style="font-weight: bold">Список пожеланий:</span> %input.ans8%</span><br>
      <hr>
      <br><br><br>Подавая заявление, я автоматически соглашаюсь со всеми правилами подачи заявления в программу возвращения домой.
    </div>
    <hr>
    <textarea id="result" rows="5" cols="50"></textarea>
    <button id="processButton">Обработать данные</button>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        function replaceInputs() {
          let body = document.body; 
          if (!body) return;
          
          let textNodes = getTextNodes(body);
          
          textNodes.forEach(function(node) {
            // if (node.nodeValue.includes('%input.')) {
            //   let attributeName = node.nodeValue.match(/%input\.([^%]+)%/)[1];
            //   let input = document.createElement('input');
            //   input.setAttribute('id', attributeName);
            //   input.setAttribute('type', 'text');
            //   node.parentNode.replaceChild(input, node);
            // }
          if (node.nodeValue.includes('%input.')) {
            let attributeName = node.nodeValue.split('%input.')[1].split('%')[0];
            let input = document.createElement('input');
            input.setAttribute('id', attributeName);
            input.setAttribute('type', 'text');
            node.parentNode.replaceChild(input, node);
          }
          });
        }
        function getTextNodes(element) {
          let textNodes = [];
          let walker = document.createTreeWalker(element, NodeFilter.SHOW_TEXT, null, false);
          while(walker.nextNode()) {
            textNodes.push(walker.currentNode);
          }
          return textNodes;
        }
        replaceInputs();
      });
      
      function escapeRegExp(string) {
        return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); // $& means the whole matched string
      }
      
      function replaceMarkers(data) {
        var templateString = `[mail][sfpd-header][/sfpd-header][center][font=Times New Roman][size=160][b]Back Home Program[/b][/size][/font][/center][hr][/hr][b][size=120]Application[/size][/b]
      
      [size=90][b]Фракции, в которых вы состояли (включая никнеймы, проекты, лидеры и причины ухода):[/b]  %input.ans1%[/size]
      [size=90][b]Планы на будущего персонажа:[/b] %input.ans2%[/size]
      
      [size=90][b]Ccылка на форумный аккаунт (G-RP):[/b] %input.ans3%[/size]
      [size=90][b]ПОЛНЫЙ Скриншот защиты (Телеграм, Google):[/b] %input.ans4%[/size]
      [size=90][b]Полный скриншот окна ЮЦП:[/b] %input.ans5%[/size]
      [size=90][b]Ссылка на страницу ВКонтакте:[/b] %input.ans6%[/size]
      
      [size=90][b]Скриншоты вашей игры (СС, необязательно за копов):[/b] %input.ans7%[/size]
      [size=90][b]Список пожеланий:[/b] %input.ans8%[/size]
      [hr][/hr]
      
      
      Подавая заявление, я автоматически соглашаюсь со всеми правилами подачи заявления в программу возвращения домой.[/mail]`;
        for (var key in data) {
          if (data.hasOwnProperty(key)) {
            // var regex = new RegExp('%input\\.' + key + '%', 'g');
      var regex = new RegExp('%input\\.' + escapeRegExp(key) + '%', 'g');
      
            templateString = templateString.replace(regex, data[key]);
          }
        }
        return templateString;
      }
      
      document.getElementById('processButton').addEventListener('click', function() {
        var data = {};
        var inputs = document.querySelectorAll('input[type="text"]');
        inputs.forEach(function(input) {
          data[input.id] = input.value;
        });
        var resultString = replaceMarkers(data);
        document.getElementById('result').value = resultString;
        navigator.clipboard.writeText(resultString).then(function() {
          console.log('Текст скопирован в буфер обмена');
        }, function(err) {
          console.error('Ошибка копирования текста в буфер обмена: ', err);
        });
      })
    </script>
  </body>
</html>